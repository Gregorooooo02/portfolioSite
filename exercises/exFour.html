<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Exercise 4</title>

    <link rel="stylesheet" href="../stylesheet.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Silkscreen&display=swap"
          rel="stylesheet">

</head>
<body>
    <nav class="navbar">
        <ul class="navbar-nav">
            <li class="logo">
                <a href="../index.html" class="nav-link">
                    <span class="link-text">Technologie XML</span>
                    <svg xmlns="http://www.w3.org/2000/svg"
                         viewBox="0 0 512 512" fill="blueviolet"><!--! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
                        <path d="M470.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-160-160c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L402.7 256 265.4 393.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l160-160zm-352 160l160-160c12.5-12.5 12.5-32.8 0-45.3l-160-160c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L210.7 256 73.4 393.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0z"/>
                    </svg>
                </a>
            </li>

            <li class="nav-item">
                <a href="exOne.html" class="nav-link">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         viewBox="0 0 640 512" fill="blueviolet"><!--! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
                        <path d="M392.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6zm80.6 120.1c-12.5 12.5-12.5 32.8 0 45.3L562.7 256l-89.4 89.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l112-112c12.5-12.5 12.5-32.8 0-45.3l-112-112c-12.5-12.5-32.8-12.5-45.3 0zm-306.7 0c-12.5-12.5-32.8-12.5-45.3 0l-112 112c-12.5 12.5-12.5 32.8 0 45.3l112 112c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l89.4-89.4c12.5-12.5 12.5-32.8 0-45.3z"/>
                    </svg>
                    <span class="link-text">Zadanie 1</span>
                </a>
            </li>

            <li class="nav-item">
                <a href="exTwo.html" class="nav-link">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         viewBox="0 0 512 512" fill="blueviolet"><!--! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
                        <path d="M432 64H208c-8.8 0-16 7.2-16 16V96H128V80c0-44.2 35.8-80 80-80H432c44.2 0 80 35.8 80 80V304c0 44.2-35.8 80-80 80H416V320h16c8.8 0 16-7.2 16-16V80c0-8.8-7.2-16-16-16zM0 192c0-35.3 28.7-64 64-64H320c35.3 0 64 28.7 64 64V448c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V192zm64 32c0 17.7 14.3 32 32 32H288c17.7 0 32-14.3 32-32s-14.3-32-32-32H96c-17.7 0-32 14.3-32 32z"/>
                    </svg>
                    <span class="link-text">Zadanie 2</span>
                </a>
            </li>

            <li class="nav-item">
                <a href="exThree.html" class="nav-link">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         viewBox="0 0 576 512" fill="blueviolet"><!--! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
                        <path d="M88.7 223.8L0 375.8V96C0 60.7 28.7 32 64 32H181.5c17 0 33.3 6.7 45.3 18.7l26.5 26.5c12 12 28.3 18.7 45.3 18.7H416c35.3 0 64 28.7 64 64v32H144c-22.8 0-43.8 12.1-55.3 31.8zm27.6 16.1C122.1 230 132.6 224 144 224H544c11.5 0 22 6.1 27.7 16.1s5.7 22.2-.1 32.1l-112 192C453.9 474 443.4 480 432 480H32c-11.5 0-22-6.1-27.7-16.1s-5.7-22.2 .1-32.1l112-192z"/>
                    </svg>
                    <span class="link-text">Zadanie 3</span>
                </a>
            </li>

            <li class="nav-item">
                <a href="#" class="nav-link">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         viewBox="0 0 640 512" fill="blueviolet"><!--! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
                        <path d="M192 64C86 64 0 150 0 256S86 448 192 448H448c106 0 192-86 192-192s-86-192-192-192H192zM496 248c-22.1 0-40-17.9-40-40s17.9-40 40-40s40 17.9 40 40s-17.9 40-40 40zm-24 56c0 22.1-17.9 40-40 40s-40-17.9-40-40s17.9-40 40-40s40 17.9 40 40zM168 200c0-13.3 10.7-24 24-24s24 10.7 24 24v32h32c13.3 0 24 10.7 24 24s-10.7 24-24 24H216v32c0 13.3-10.7 24-24 24s-24-10.7-24-24V280H136c-13.3 0-24-10.7-24-24s10.7-24 24-24h32V200z"/>
                    </svg>
                    <span class="link-text">Zadanie 4</span>
                </a>
            </li>

            <li class="nav-item">
                <a href="exFive.html" class="nav-link">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         viewBox="0 0 384 512" fill="blueviolet"><!--! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
                        <path d="M64 0C28.7 0 0 28.7 0 64V448c0 35.3 28.7 64 64 64H320c35.3 0 64-28.7 64-64V160H256c-17.7 0-32-14.3-32-32V0H64zM256 0V128H384L256 0zM153 289l-31 31 31 31c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0L71 337c-9.4-9.4-9.4-24.6 0-33.9l48-48c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9zM265 255l48 48c9.4 9.4 9.4 24.6 0 33.9l-48 48c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l31-31-31-31c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0z"/>
                    </svg>
                    <span class="link-text">Zadanie 5</span>
                </a>
            </li>

            <li class="nav-item">
                <a href="#" class="nav-link">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         viewBox="0 0 512 512" fill="blueviolet"><!--! Font Awesome Pro 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
                        <path d="M256 512c141.4 0 256-114.6 256-256S397.4 0 256 0S0 114.6 0 256S114.6 512 256 512zM169.8 165.3c7.9-22.3 29.1-37.3 52.8-37.3h58.3c34.9 0 63.1 28.3 63.1 63.1c0 22.6-12.1 43.5-31.7 54.8L280 264.4c-.2 13-10.9 23.6-24 23.6c-13.3 0-24-10.7-24-24V250.5c0-8.6 4.6-16.5 12.1-20.8l44.3-25.4c4.7-2.7 7.6-7.7 7.6-13.1c0-8.4-6.8-15.1-15.1-15.1H222.6c-3.4 0-6.4 2.1-7.5 5.3l-.4 1.2c-4.4 12.5-18.2 19-30.6 14.6s-19-18.2-14.6-30.6l.4-1.2zM288 352c0 17.7-14.3 32-32 32s-32-14.3-32-32s14.3-32 32-32s32 14.3 32 32z"/>
                    </svg>
                    <span class="link-text">Podsumowanie</span>
                </a>
            </li>
        </ul>
    </nav>

    <main class="exFour">
        <div class="heading">
            <h1>Zadanie 4</h1>
        </div>
        <p>Stwórz dowolną grę z wykorzystaniem SVG wraz z interakcją w JavaScript.</p>

        <hr class="rounded"/>

        <div class="heading">
            <h2>Rozwiązanie</h2>
        </div>
        <button class="accordion">Plik HTML z SVG</button>
        <div class="accordionPanel codeBox">
            <pre>
                <code>
&lt!DOCTYPE html&gt
&lthtml lang=&quoten&quot&gt
&lthead&gt
    &ltmeta charset=&quotUTF-8&quot&gt
    &lttitle&gtPong with SVG&lt/title&gt
    &ltscript type=&quottext/javascript&quot src=&quotpongScript.js&quot&gt&lt/script&gt
&lt/head&gt
&ltbody onload=&quotsvgPong()&quot&gt
  &ltsvg id=&quotfield&quot
       xmlns=&quothttp://www.w3.org/2000/svg&quot
       viewBox=&quot0 0 800 600&quot
       preserveAspectRatio=&quotxMidYMid&quot&gt
    &ltstyle&gt
      .score {
        text-anchor: middle;
        font-family: &quotPixel Operator Mono&quot, monospace;
        font-size: 36px;
      }

      #field {
        left:0;
        top:0;
        width:100%;
        height:100%;
        position : absolute;
        display: inline-block;
      }

    &lt/style&gt

    &ltrect id=&quotbackground&quot
          width=&quot800&quot
          height=&quot600&quot
          fill=&quot#00000&quot/&gt

    &ltline x1=&quot400&quot y1=&quot600&quot
          x2=&quot400&quot y2=&quot0&quot
          stroke-width=&quot2&quot stroke-dasharray=&quot5,5&quot
          stroke=&quot#FFF&quot/&gt

    &lttext class=&quotscore&quot id=&quotplayerScore&quot
          x=&quot300&quot y=&quot50&quot
          fill=&quot#FFF&quot&gt
      0
    &lt/text&gt
    &lttext class=&quotscore&quot id=&quotcomputerScore&quot
          x=&quot500&quot y=&quot50&quot
          fill=&quot#FFF&quot&gt
      0
    &lt/text&gt

    &ltrect id=&quotpaddleLeft&quot
          width=&quot20&quot height=&quot100&quot
          x=&quot10&quot y=&quot240&quot rx=&quot5&quot
          fill=&quot#D633FF&quot
          filter=&quoturl(#softGlowPlayer)&quot/&gt

    &ltrect id=&quotpaddleRight&quot
          width=&quot20&quot height=&quot100&quot
          x=&quot770&quot y=&quot240&quot rx=&quot5&quot
          fill=&quot#33EEFF&quot
          filter=&quoturl(#softGlowComputer)&quot/&gt

    &ltcircle id=&quotball&quot
            r=&quot10&quot
            cx=&quot400&quot cy=&quot300&quot
            fill=&quot#FFF&quot/&gt

    &ltfilter id=&quotsoftGlowPlayer&quot
            height=&quot300%&quot width=&quot300%&quot
            x=&quot-75%&quot y=&quot-75%&quot&gt
      &ltfeMorphology operator=&quotdilate&quot radius=&quot4&quot in=&quotSourceAlpha&quot result=&quotthicken&quot/&gt

      &ltfeGaussianBlur in=&quotthicken&quot stdDeviation=&quot7&quot result=&quotblurred&quot/&gt

      &ltfeFlood flood-color=&quot#D633FF&quot result=&quotglowColor&quot/&gt

      &ltfeComposite in=&quotglowColor&quot in2=&quotblurred&quot operator=&quotin&quot result=&quotsoftGlow_colored&quot/&gt

      &ltfeMerge&gt
        &ltfeMergeNode in=&quotsoftGlow_colored&quot/&gt
        &ltfeMergeNode in=&quotSourceGraphic&quot/&gt
      &lt/feMerge&gt

    &lt/filter&gt

    &ltfilter id=&quotsoftGlowComputer&quot
            height=&quot300%&quot width=&quot300%&quot
            x=&quot-75%&quot y=&quot-75%&quot&gt
      &ltfeMorphology operator=&quotdilate&quot radius=&quot4&quot in=&quotSourceAlpha&quot result=&quotthicken&quot/&gt

      &ltfeGaussianBlur in=&quotthicken&quot stdDeviation=&quot7&quot result=&quotblurred&quot/&gt

      &ltfeFlood flood-color=&quot#33EEFF&quot result=&quotglowColor&quot/&gt

      &ltfeComposite in=&quotglowColor&quot in2=&quotblurred&quot operator=&quotin&quot result=&quotsoftGlow_colored&quot/&gt

      &ltfeMerge&gt
        &ltfeMergeNode in=&quotsoftGlow_colored&quot/&gt
        &ltfeMergeNode in=&quotSourceGraphic&quot/&gt
      &lt/feMerge&gt

    &lt/filter&gt

  &lt/svg&gt
&lt/body&gt
&lt/html&gt
                </code>
            </pre>
        </div>

        <button class="accordion">Plik JavaScript</button>
        <div class="accordionPanel codeBox">
            <pre>
                <code>
svgPong = function () {
    let field = document.getElementById('field');

    if (field == null) {
        alert("!!!Could not find SVG graphic file!!!");
        return;
    }

    (function() {
        window.requestAnimationFrame = window.requestAnimationFrame || window.webkitRequestAnimationFrame;
    })();

    // Initial paddle
    function wrapPaddle(name) {
        let e = document.getElementById(name)
        let r = {}

        r.width = e.width.baseVal.value
        r.height = e.height.baseVal.value

        function update() {
            r.right = r.x + r.width
            r.left = r.x
            r.top = r.y
            r.bottom = r.y + r.height
        }

        Object.defineProperty(r, "x", {
            get: function () {return e.x.baseVal.value},
            set: function (val) {e.x.baseVal.value = val; update();}
        })
        Object.defineProperty(r, "y", {
            get: function () {return e.y.baseVal.value},
            set: function (val) {e.y.baseVal.value = val; update();}
        })
        Object.defineProperty(r, "cx", {
            get: function () {return r.x + r.width / 2;},
            set: function (val) {r.x = val - r.width / 2;}
        })
        Object.defineProperty(r, "cy", {
            get: function () {return r.y + r.height / 2;},
            set: function (val) {r.y = val - r.height / 2;}
        })

        update();

        return r;
    }

    // Create objects for paddles
    let player = wrapPaddle('paddleLeft')
    let computer = wrapPaddle('paddleRight')

    // Creating a ball and it's methods
    let ball = function () {
        let e = document.getElementById('ball')

        let r = {}
        r.dx = 0
        r.dy = 0

        function update() {
            r.right = r.cx + r.r;
            r.left = r.cx - r.r;
            r.top = r.cy - r.r;
            r.bottom = r.cy + r.r;
        }

        Object.defineProperty(r, "cx", {
            get: function () {return e.cx.baseVal.value},
            set: function (val) {e.cx.baseVal.value = val; update();}
        })
        Object.defineProperty(r, "cy", {
            get: function () {return e.cy.baseVal.value},
            set: function (val) {e.cy.baseVal.value = val; update();}
        })
        Object.defineProperty(r, "r", {
            get: function () {return e.r.baseVal.value},
            set: function (val) {e.r.baseVal.value = val; update();}
        })

        update();

        return r;
    }();

    // Player's and Computer's score
    let playerScore = document.getElementById('playerScore')
    let computerScore = document.getElementById('computerScore')

    let box = field.viewBox.baseVal;

    // Initial ball state vector init
    let startX = box.width / 2;
    let startY = box.height / 2;

    let clock = function () {
        let last = Date.now();

        return {
            'reset': function () {
                let now = Date.now();
                let result = now - last;
                last = now;

                return result;
            }
        }
    }()

    let animationSpeed = 0.1;   // Pixel per ms
    let computerSpeed = 4;      // Difficulty of the computer

    let scorePlayer = 0;        // Player score (Int type)
    let scoreComputer = 0;      // Computer score (Int type)

    let inputY = 0;             // Input in Y axis for moving the player

    let verticalCenter = box.height / 2;
    let deflectFactor = 0.1;

    /** Collider function, makes ball bounce of smt.
     *
     * @param what From what should the ball bounce off
     */
    function collideBallWith(what) {
        if (ball.bottom < what.top || ball.top > what.bottom) {
            // There's no collision
            return;
        }

        let voff = ball.cy - what.cy

        if (ball.dx < 0) {

            // Collide with right border
            if (ball.left <= what.right && ball.right > what.left) {
                // Collision
                ball.cx += what.right - ball.left;
                ball.dx *= -1;
                ball.dy += voff * deflectFactor;
            }
        }
        else {
            // Collide with left border
            if (ball.right >= what.left && ball.left < what.right) {
                // Collision
                ball.cx -= ball.right - what.left;
                ball.dx *= -1;
                ball.dy += voff * deflectFactor;
            }
        }
    }

    /** Creates a bound for the paddle.
     *
     * @param paddle Which paddle should have bounds
     */
    function boundPaddle(paddle) {
        if (paddle.bottom > box.height) {
            paddle.y = box.height - paddle.height
        }
        else if (paddle.top < 0) {
            paddle.y = 0
        }
    }

    /** Makes score system work fine ;)
     *
     */
    function scored() {
        ball.dx = 0;
        ball.dy = 0;

        ball.cx = startX;
        ball.cy = startY;

        setTimeout(function () {
            if (Math.random() > 0.5)
                ball.dx = 5;
            else
                ball.dx = -5;

            ball.dy = 5 - Math.random() * 10
        }, 3000);

        if (scorePlayer === 5) {
            alert("YOU WON");
            document.location.reload();
        }

        if (scoreComputer === 5) {
            alert("GAME OVER");
            document.location.reload();
        }
    }

    // Setup
    scored();

    /** Init animations for the game
     *
     */
    let animate = function () {
        let suspense = field.suspendRedraw(6000);

        let animationFactor = clock.reset() * animationSpeed

        ball.cx += ball.dx * animationFactor;
        ball.cy += ball.dy * animationFactor;

        // Player movement
        player.cy = inputY;

        // Test player as computer
        // let offset1;
        // let motivation1;
        //
        // if (ball.dx < 0) {
        //    offset1 = ball.cy - player.cy
        //    motivation1 = Math.min(1, Math.pow(Math.abs(offset1) / (player.height / 4), 2))
        // } else {
        //    offset1 = verticalCenter - player.cy
        //    motivation1 = Math.abs(offset1) > verticalCenter / 4 ? 0.5 : 0
        // }
        //
        // if (offset1 > 0) {
        //    player.cy += computerSpeed * animationFactor * motivation1
        // }
        // else {
        //    player.cy -= computerSpeed * animationFactor * motivation1
        // }
        // end of definition
        boundPaddle(player)

        // Computer AI
        let offset;
        let motivation;

        if (ball.dx > 0) {
            offset = ball.cy - computer.cy
            motivation = Math.min(1, Math.pow(Math.abs(offset) / (computer.height / 4), 2))
        } else {
            offset = verticalCenter - computer.cy
            motivation = Math.abs(offset) > verticalCenter / 4 ? 0.5 : 0
        }

        if (offset > 0) {
            computer.cy += computerSpeed * animationFactor * motivation
        }
        else {
            computer.cy -= computerSpeed * animationFactor * motivation
        }
        boundPaddle(computer)

        // Paddle bounds
        collideBallWith(player)
        collideBallWith(computer)

        // Wall bounding and scoring
        if (ball.right >= box.width) {
            ball.cx -= ball.right - box.width;
            ball.dx *= -1;

            // Score
            scorePlayer += 1;
            playerScore.textContent = scorePlayer;
            scored()
        }
        else if (ball.left <= 0) {
            ball.cx -= ball.left;
            ball.dx *= -1;

            //Score
            scoreComputer += 1;
            computerScore.textContent = scoreComputer;
            scored()
        }

        // Collision with field bounds
        if (ball.top <= 0) {
            ball.cy -= ball.top;
            ball.dy *= -1;
        }
        else if (ball.bottom >= box.height) {
            ball.cy -= ball.bottom - box.height;
            ball.dy *= -1;
        }

        field.unsuspendRedraw(suspense);
        requestAnimationFrame(animate);
    }

    let matrix = field.getScreenCTM().inverse();

    // Controls for the player
    field.addEventListener("mousemove", function (event) {
        event.preventDefault()

        let p = field.createSVGPoint()
        p.x = event.clientX
        p.y = event.clientY
        let inSVG = p.matrixTransform(matrix)

        inputY = inSVG.y
    })

    // Start animation
    requestAnimationFrame(animate)
}
                </code>
            </pre>
        </div>
                <script>
            let accordion = document.getElementsByClassName("accordion");
            let i;

            for (i = 0; i < accordion.length; ++i) {
                accordion[i].addEventListener("click", function() {
                    this.classList.toggle("active");
                    let panel = this.nextElementSibling;

                    if (panel.style.maxHeight) {
                        panel.style.maxHeight = null;
                    }
                    else {
                        panel.style.maxHeight = panel.scrollHeight + "px";
                    }
                });
            }
        </script>
        <br/>
        <a class="exerciseLink" href="../exercisesFiles/exercise4/pongGame.html" target="download">Sprawdź zadanie!</a>
    </main>
</body>
</html>